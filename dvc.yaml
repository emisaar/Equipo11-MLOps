stages:
  load_data:
    cmd: python src/01_load_data.py
    deps:
      - src/01_load_data.py
      - src/power_pipeline.py
      - ${data.raw_path}
    params:
      - features.datetime_column
      - data.raw_path
      - data.interim_loaded
    outs:
      - ${data.interim_loaded}

  explore_data:
    cmd: python src/02_explore_data.py
    deps:
      - src/02_explore_data.py
      - src/power_pipeline.py
      - ${data.interim_loaded}
    params:
      - reports.eda_dir
      - eda.sample_rows
    outs:
      - ${reports.eda_dir}

  preprocess_data:
    cmd: python src/03_preprocess_data.py
    deps:
      - src/03_preprocess_data.py
      - src/power_pipeline.py
      - ${data.interim_loaded}
    params:
      - features.datetime_column
      - features.target.preferred
      - features.lags
      - split.test_size
      - split.random_state
      - data.train
      - data.test
    outs:
      - ${data.train}
      - ${data.test}

  train_model:
    cmd: python src/04_train_model.py
    deps:
      - src/04_train_model.py
      - src/power_pipeline.py
      - ${data.train}
    params:
      - features.target.preferred
      - model.path
      - model.rf_params
    outs:
      - ${model.path}

  evaluate_model:
    cmd: python src/05_evaluate_model.py
    deps:
      - src/05_evaluate_model.py
      - src/power_pipeline.py
      - ${data.test}
      - ${model.path}
    params:
      - features.target.preferred
      - metrics.path
      - reports.figures_dir
    outs:
      - ${reports.figures_dir}
    metrics:
      - ${metrics.path}:
          cache: false