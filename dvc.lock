schema: '2.0'
stages:
  load_data:
    cmd: cmd /c "set PYTHONPATH=src && python src/pipeline/01_load_data.py
    deps:
    - path: data/raw/power_tetouan_city_modified.csv
      hash: md5
      md5: 877912f20b66bcc5a56223d31d788164
      size: 4564430
    - path: src/classes/LoadData.py
      hash: md5
      md5: f984fd859f71cc3b5ad9ce90471bbdb7
      size: 5689
    - path: src/pipeline/01_load_data.py
      hash: md5
      md5: 1586dfeef83d1f23fe4f7963b06622fb
      size: 758
    params:
      params.yaml:
        data.interim_loaded: data/interim/loaded.parquet
        data.raw_path: data/raw/power_tetouan_city_modified.csv
        data.source: file
        features.datetime_column: datetime
    outs:
    - path: data/interim/loaded.parquet
      hash: md5
      md5: 869bb83e16756f309eda38e3720111f4
      size: 2047191
  explore_data:
    cmd: cmd /c "set PYTHONPATH=src && python src/pipeline/02_explore_data.py
    deps:
    - path: data/interim/loaded.parquet
      hash: md5
      md5: 869bb83e16756f309eda38e3720111f4
      size: 2047191
    - path: src/classes/ExploreData.py
      hash: md5
      md5: 38f91a0114218f09867228e21ed502a3
      size: 14146
    - path: src/pipeline/02_explore_data.py
      hash: md5
      md5: 8c2a8b8cf31e75a8a7f8472b4552f811
      size: 716
    params:
      params.yaml:
        eda.sample_rows: 5
        reports.eda_dir: reports/eda
    outs:
    - path: reports/eda
      hash: md5
      md5: 04b3038cc92356d814645ffa3f674ed8.dir
      size: 321552
      nfiles: 13
  preprocess_data:
    cmd: cmd /c "set PYTHONPATH=src && python src/pipeline/03_preprocess_data.py
    deps:
    - path: data/interim/loaded.parquet
      hash: md5
      md5: 869bb83e16756f309eda38e3720111f4
      size: 2047191
    - path: src/classes/PreprocessData.py
      hash: md5
      md5: 7a67ea92bf08368a7f32df34c81d2b23
      size: 13448
    - path: src/pipeline/03_preprocess_data.py
      hash: md5
      md5: 963ce9789179216d71a741ccb815217a
      size: 1101
    params:
      params.yaml:
        data.cleaned: data/processed/cleaned_sample.parquet
        data.test: data/processed/test.parquet
        data.train: data/processed/train.parquet
        features.datetime_column: datetime
        features.lags:
        - 1
        - 24
        - 168
        features.target.preferred: zone_1_power_consumption
        split.random_state: 42
        split.test_size: 0.3
    outs:
    - path: data/processed/test.parquet
      hash: md5
      md5: ba15e6d826fe45501b639256412f02b9
      size: 29299
    - path: data/processed/train.parquet
      hash: md5
      md5: a0c2ed5961cdcb25e918d468b58bdc5f
      size: 60369
  train_model:
    cmd: cmd /c "set PYTHONPATH=src && python src/pipeline/04_train_model.py
    deps:
    - path: data/processed/train.parquet
      hash: md5
      md5: a0c2ed5961cdcb25e918d468b58bdc5f
      size: 60369
    - path: src/classes/TrainModel.py
      hash: md5
      md5: 332a30b61e5a8c66f4613cb9c90f7f1d
      size: 2983
    - path: src/pipeline/04_train_model.py
      hash: md5
      md5: fbc9e0fb5b297454015010b7fc5a7bc2
      size: 757
    params:
      params.yaml:
        features.target.preferred: zone_1_power_consumption
        model.model_params:
          n_estimators: 800
          learning_rate: 0.05
          max_depth: 6
          min_child_weight: 3
          subsample: 0.8
          colsample_bytree: 0.8
          gamma: 0.1
          reg_lambda: 1.0
          reg_alpha: 0.1
          random_state: 42
          objective: reg:squarederror
          n_jobs: -1
        model.path: models/power_tetouan_model.pkl
    outs:
    - path: models/power_tetouan_model.pkl
      hash: md5
      md5: bd0fc5ec2c1fe4058e57f6b9c5ef545b
      size: 2673235
  evaluate_model:
    cmd: cmd /c "set PYTHONPATH=src && python src/pipeline/05_evaluate_model.py
    deps:
    - path: data/processed/test.parquet
      hash: md5
      md5: ba15e6d826fe45501b639256412f02b9
      size: 29299
    - path: models/power_tetouan_model.pkl
      hash: md5
      md5: bd0fc5ec2c1fe4058e57f6b9c5ef545b
      size: 2673235
    - path: src/classes/EvaluateModel.py
      hash: md5
      md5: 4b3320ddcfb49605a308845bfa193de5
      size: 5900
    - path: src/pipeline/05_evaluate_model.py
      hash: md5
      md5: 190dd833068f7280c7f0a71df19b6b9a
      size: 1012
    params:
      params.yaml:
        features.target.preferred: zone_1_power_consumption
        metrics.path: metrics/metrics.json
        reports.figures_dir: reports/figures
    outs:
    - path: metrics/metrics.json
      hash: md5
      md5: 8d04649e136f3d2d8737c76b3452222d
      size: 219
    - path: reports/figures
      hash: md5
      md5: 57cfed4b58f85ac904c058c6286d8787.dir
      size: 299639
      nfiles: 2
